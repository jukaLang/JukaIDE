dist: focal
language: csharp
dotnet: 6.0
mono: none

before_install:
- export JUKTEMP=$(curl "https://api.github.com/repos/JukaLang/juka/releases/latest" | jq -r ".tag_name")

script:
  - sudo dotnet workload install wasm-tools
  - sudo dotnet add package JukaCompiler
  - sudo dotnet publish -c Release

before_deploy:
  - export TRAVIS_TAG=${JUKTEMP}
  - tar -zcf Juka_WebAssembly_${TRAVIS_TAG}.tar.gz -C bin/Release/net6.0/publish/ wwwroot
  - git tag $TRAVIS_TAG

deploy:
  provider: releases
  api_key:
     secure: "dw/7LNBERjFgOQHJZ6yzmZH0MfzPQXveFy15KFAELSXlXTT0oREz995Jl/+/GZb9nPoMqT5veFoXPCSgRY9jqefeXc8AAm5KtpuoK5v7DMtUM7aJa+Xq0VCHIRUrz0qxu8+eP9FO2nnrRyyu+QtMpNdgyV3i9nlwGsQ+cHSI/7eL4k6rEkZc/YoB2iyHvu/xNWaCUTAsmcdXh8zDwvOZOv8wYbk+j3Pc/Gl4qUF3sMlh011cvq9WCK0gcxIsTI7e5/AJqnqQuIQ1jrgaGj61ZkZgYyac6wSeDcrIYCsh+vhMCJe1O1UKBCiPY776UnuwJH7kKQz3QlBoPKzum5ak4k451C4KzSImSbdJ7ZzApOn6tOwWIXM5u3D1OxVqnmpkeM2Oa1UIMJImTXglXaRQ06UD69iUk0TdCJ6gyjaDomfPd/H5+Udw73rheQcBg9FjdcX0uZG48hpPVzOliCP/gmYvyHKaZVauPe5UGng6ukH5/12iEbpjqmzy/Ob73tYGmXNJVuFgaDviiHzF30/Liys6xg95Pnixfs4KefEzK2dv276qGNJXCB7DT+WlEisTutfiAEjyjsfDaiDFX2+PuzGsx77zlSdg8gOtxci9KNmbadew5hSWx5C5IGtCD3oHGBkuDRBRNsx/ks3eZXAmu9kvqtetyKBCZBMY/U8ZliY="
  file_glob: true
  file: Juka_WebAssembly_${TRAVIS_TAG}.tar.gz
  on:
    all_branches: true
    tags: false